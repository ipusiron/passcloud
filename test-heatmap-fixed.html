<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fixed Heatmap Alignment</title>
    <style>
        :root {
            --text-primary: #333;
            --text-secondary: #666;
            --bg-secondary: #f5f5f5;
        }
        
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #fff;
        }
        
        /* Debug styles */
        .debug-mode .y-axis-values,
        .debug-mode .heatmap-grid {
            outline: 2px solid red;
        }
        
        .debug-mode .y-value,
        .debug-mode .heatmap-row {
            outline: 1px solid blue;
        }
        
        .comparison {
            display: flex;
            gap: 40px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .comparison > div {
            flex: 1;
            min-width: 400px;
        }
    </style>
    <link rel="stylesheet" href="css/heatmap.css">
    <link rel="stylesheet" href="css/heatmap-fixed.css">
</head>
<body>
    <h1>Heatmap Y-axis Alignment Comparison</h1>
    
    <div style="margin-bottom: 20px;">
        <button onclick="toggleDebug()">Toggle Debug Mode</button>
        <button onclick="checkBothAlignments()">Check Alignments</button>
    </div>
    
    <div class="comparison">
        <div>
            <h2>Original Implementation</h2>
            <div id="originalHeatmap"></div>
        </div>
        
        <div>
            <h2>Fixed Implementation (CSS Grid)</h2>
            <div id="fixedHeatmap"></div>
        </div>
    </div>
    
    <div id="results" style="margin-top: 20px; font-family: monospace; white-space: pre; background: #f0f0f0; padding: 10px;"></div>
    
    <script>
        let debugMode = false;
        
        function generateHeatmap(containerId, useFixed = false) {
            const rowsCount = 10;
            const lengths = [];
            for (let i = 5; i <= 14; i++) {
                lengths.push(i);
            }
            
            // Use different class names for fixed version
            const wrapperClass = useFixed ? 'heatmap-wrapper' : 'heatmap-wrapper';
            const yAxisClass = useFixed ? 'heatmap-y-axis' : 'heatmap-y-axis';
            
            const html = `
                <div class="heatmap-container">
                    <div class="${wrapperClass}" style="--rows-count: ${rowsCount}">
                        <!-- Y-axis -->
                        <div class="${yAxisClass}">
                            <div class="y-axis-label">Length</div>
                            <div class="y-axis-values-wrapper">
                                <div class="y-axis-values">
                                    ${lengths.reverse().map((len, i) => `
                                        <div class="y-value">${len}</div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Main heatmap -->
                        <div class="heatmap-main">
                            <div class="heatmap-grid" style="--rows-count: ${rowsCount}">
                                ${generateRows(rowsCount)}
                            </div>
                            
                            <div class="heatmap-x-axis">
                                <div class="x-axis-values">
                                    ${Array(8).fill(0).map((_, i) => `<div class="x-value">F${i+1}</div>`).join('')}
                                </div>
                                <div class="x-axis-label">Frequency</div>
                            </div>
                        </div>
                        
                        <!-- Legend -->
                        <div class="heatmap-legend">
                            <div class="legend-title">Count</div>
                            <div class="legend-scale">
                                <div class="legend-max">100</div>
                                <div class="legend-gradient" style="background: linear-gradient(to bottom, #ff0000, #ffff00, #00ff00, #0000ff, #f5f5f5)"></div>
                                <div class="legend-min">0</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById(containerId).innerHTML = html;
        }
        
        function generateRows(count) {
            let html = '';
            for (let i = 0; i < count; i++) {
                html += '<div class="heatmap-row">';
                for (let j = 0; j < 8; j++) {
                    const intensity = ((i + 1) * (j + 1)) / (count * 8);
                    const hue = 200 + intensity * 160;
                    const lightness = 30 + (1 - intensity) * 40;
                    const color = `hsl(${hue}, 70%, ${lightness}%)`;
                    html += `<div class="heatmap-cell" style="background-color: ${color};"></div>`;
                }
                html += '</div>';
            }
            return html;
        }
        
        function toggleDebug() {
            debugMode = !debugMode;
            document.body.classList.toggle('debug-mode', debugMode);
        }
        
        function checkAlignment(containerId, label) {
            const container = document.getElementById(containerId);
            const yValues = container.querySelectorAll('.y-value');
            const rows = container.querySelectorAll('.heatmap-row');
            const results = [];
            
            results.push(`\\n=== ${label} ===`);
            
            // Check each pair
            let alignedCount = 0;
            let totalOffset = 0;
            
            yValues.forEach((yValue, i) => {
                const yRect = yValue.getBoundingClientRect();
                const row = rows[i];
                
                if (row) {
                    const rowRect = row.getBoundingClientRect();
                    const yCenter = yRect.top + yRect.height / 2;
                    const rowCenter = rowRect.top + rowRect.height / 2;
                    const offset = Math.abs(yCenter - rowCenter);
                    
                    totalOffset += offset;
                    if (offset < 1) alignedCount++;
                }
            });
            
            const avgOffset = totalOffset / yValues.length;
            results.push(`  Aligned items: ${alignedCount}/${yValues.length}`);
            results.push(`  Average offset: ${avgOffset.toFixed(2)}px`);
            results.push(`  Status: ${alignedCount === yValues.length ? '✓ PERFECT' : avgOffset < 2 ? '~ GOOD' : '✗ NEEDS FIX'}`);
            
            return results.join('\\n');
        }
        
        function checkBothAlignments() {
            let results = 'ALIGNMENT CHECK RESULTS:';
            results += checkAlignment('originalHeatmap', 'Original Implementation');
            results += checkAlignment('fixedHeatmap', 'Fixed Implementation (CSS Grid)');
            
            document.getElementById('results').textContent = results;
        }
        
        // Generate both heatmaps on load
        window.addEventListener('load', () => {
            generateHeatmap('originalHeatmap', false);
            generateHeatmap('fixedHeatmap', true);
            
            // Auto-check after a delay
            setTimeout(checkBothAlignments, 100);
        });
    </script>
</body>
</html>