<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heatmap Alignment Visual Test</title>
    <style>
        :root {
            --text-primary: #333;
            --text-secondary: #666;
            --bg-secondary: #f5f5f5;
        }
        
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #fff;
        }
        
        /* Visual alignment helpers */
        .alignment-guide {
            position: absolute;
            left: 0;
            right: 0;
            height: 25px;
            border-top: 1px dashed rgba(255, 0, 0, 0.5);
            border-bottom: 1px dashed rgba(255, 0, 0, 0.5);
            pointer-events: none;
            z-index: 10;
        }
        
        .heatmap-wrapper {
            position: relative;
        }
        
        /* Highlight first and last items */
        .y-value:first-child,
        .heatmap-row:first-child {
            background-color: rgba(0, 255, 0, 0.3) !important;
        }
        
        .y-value:last-child,
        .heatmap-row:last-child {
            background-color: rgba(255, 0, 0, 0.3) !important;
        }
        
        /* Add visible borders */
        .y-axis-values,
        .heatmap-grid {
            border: 2px solid blue;
        }
        
        .y-value,
        .heatmap-row {
            border: 1px solid rgba(0, 0, 0, 0.2);
        }
    </style>
    <link rel="stylesheet" href="css/heatmap.css">
</head>
<body>
    <h1>Heatmap Y-axis Alignment Test</h1>
    <p>Green = First item, Red = Last item, Blue border = Container boundaries</p>
    
    <div id="heatmapView"></div>
    
    <div style="margin-top: 20px;">
        <button onclick="checkAlignment()">Check Alignment</button>
        <button onclick="addGuides()">Add Alignment Guides</button>
        <button onclick="removeGuides()">Remove Guides</button>
    </div>
    
    <div id="results" style="margin-top: 20px; font-family: monospace; white-space: pre;"></div>
    
    <script>
        function generateTestHeatmap() {
            const rowsCount = 8; // Use 8 rows for easier visualization
            const lengths = [];
            for (let i = 6; i <= 13; i++) {
                lengths.push(i);
            }
            
            const html = `
                <div class="heatmap-container">
                    <h2>Alignment Test Heatmap</h2>
                    
                    <div class="heatmap-wrapper" id="heatmapWrapper">
                        <!-- Y-axis -->
                        <div class="heatmap-y-axis">
                            <div class="y-axis-label">Length</div>
                            <div class="y-axis-values-wrapper">
                                <div class="y-axis-values" style="--rows-count: ${rowsCount}">
                                    ${lengths.reverse().map((len, i) => `
                                        <div class="y-value" data-index="${i}">${len}</div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Main heatmap -->
                        <div class="heatmap-main">
                            <div class="heatmap-grid">
                                ${generateRows(rowsCount)}
                            </div>
                            
                            <div class="heatmap-x-axis">
                                <div class="x-axis-values">
                                    ${Array(8).fill(0).map((_, i) => `<div class="x-value">F${i+1}</div>`).join('')}
                                </div>
                                <div class="x-axis-label">Frequency</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('heatmapView').innerHTML = html;
        }
        
        function generateRows(count) {
            let html = '';
            for (let i = 0; i < count; i++) {
                html += `<div class="heatmap-row" data-index="${i}">`;
                for (let j = 0; j < 8; j++) {
                    const intensity = (i + j) / (count + 8);
                    const color = `hsl(${200 + intensity * 60}, 70%, ${40 + intensity * 30}%)`;
                    html += `<div class="heatmap-cell" style="background-color: ${color};"></div>`;
                }
                html += '</div>';
            }
            return html;
        }
        
        function checkAlignment() {
            const yValues = document.querySelectorAll('.y-value');
            const rows = document.querySelectorAll('.heatmap-row');
            const results = [];
            
            results.push('=== ALIGNMENT CHECK ===\\n');
            
            // Container analysis
            const yContainer = document.querySelector('.y-axis-values');
            const gridContainer = document.querySelector('.heatmap-grid');
            
            results.push('Container Heights:');
            results.push(`  Y-axis container: ${yContainer.offsetHeight}px`);
            results.push(`  Grid container: ${gridContainer.offsetHeight}px`);
            results.push(`  Difference: ${Math.abs(yContainer.offsetHeight - gridContainer.offsetHeight)}px\\n`);
            
            // Container positions
            const yContainerRect = yContainer.getBoundingClientRect();
            const gridContainerRect = gridContainer.getBoundingClientRect();
            
            results.push('Container Positions:');
            results.push(`  Y-axis top: ${yContainerRect.top.toFixed(2)}px`);
            results.push(`  Grid top: ${gridContainerRect.top.toFixed(2)}px`);
            results.push(`  Top alignment: ${Math.abs(yContainerRect.top - gridContainerRect.top) < 1 ? '✓ ALIGNED' : '✗ MISALIGNED by ' + Math.abs(yContainerRect.top - gridContainerRect.top).toFixed(2) + 'px'}\\n`);
            
            // Individual item analysis
            results.push('Individual Items:');
            yValues.forEach((yValue, i) => {
                const yRect = yValue.getBoundingClientRect();
                const row = rows[i];
                
                if (row) {
                    const rowRect = row.getBoundingClientRect();
                    const yCenter = yRect.top + yRect.height / 2;
                    const rowCenter = rowRect.top + rowRect.height / 2;
                    const offset = yCenter - rowCenter;
                    
                    results.push(`  Item ${i}: Y="${yValue.textContent}" `);
                    results.push(`    Y-center: ${yCenter.toFixed(2)}px, Row-center: ${rowCenter.toFixed(2)}px`);
                    results.push(`    Offset: ${offset.toFixed(2)}px ${Math.abs(offset) < 1 ? '✓' : '✗'}`);
                }
            });
            
            document.getElementById('results').textContent = results.join('\\n');
        }
        
        function addGuides() {
            removeGuides();
            
            const wrapper = document.getElementById('heatmapWrapper');
            const rows = document.querySelectorAll('.heatmap-row');
            
            rows.forEach((row, i) => {
                const rect = row.getBoundingClientRect();
                const wrapperRect = wrapper.getBoundingClientRect();
                
                const guide = document.createElement('div');
                guide.className = 'alignment-guide';
                guide.style.top = (rect.top - wrapperRect.top) + 'px';
                guide.style.opacity = (i % 2 === 0) ? '0.3' : '0.1';
                wrapper.appendChild(guide);
            });
        }
        
        function removeGuides() {
            document.querySelectorAll('.alignment-guide').forEach(g => g.remove());
        }
        
        // Generate on load
        window.addEventListener('load', () => {
            generateTestHeatmap();
            setTimeout(checkAlignment, 100);
        });
    </script>
</body>
</html>